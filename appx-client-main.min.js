/*********************************************************************
 **
 **   server/appx-client-main.js - Client main logic processing
 **
 **   This module contains code to process the main client logic.
 **
 *********************************************************************/
"use strict"
function appxobjectcreatehandler(e){appx_session.objEventFired=!1,appxSetLocked(!0),appx_session.objItems=[],appx_session.ws.send(JSON.stringify({cmd:"appxmessage",args:[0,0,0,0,0,0,0,0],handler:"appxobjectcreatehandler",data:null}))}function appxobjectinvokehandler(e){try{if(e.data.proto.indexOf("addListItem")!=-1)appx_session.objItems.push(e.data.argBlocks[0].dataObject)
else if(e.data.proto.indexOf("showTheList")!=-1){var o=appxGetScanCursorPos(),s=$("#"+getClientId("appxitem_"+o.col+"_"+o.row))
if(s.length){for(var a=$("<select>"),t=appx_session.objItems.length,p=s.val(),n=0;n<t;n++){var i=$("<option>").attr("value",n+1).html(appx_session.objItems[n]).appendTo(a)
appx_session.objItems[n]==p&&i.attr("selected","selected")}var c=99999,l=s.offset()
l.top+=21
var r=s.parent(),x=s.position().top+21,d=s.closest(".appxbox").height()
r.hasClass("appx-scroll-act")&&(r=$(".appxbox.appx-scroll").parent(),d=r.height()),x+17*t>d&&(t=(d-x)/17),appxSetLocked(!1),a.appendTo(r).attr("size",t).blur(function(){appx_session.objFocus=$("<select>").val("0"),appxFireObjectEvent()}).click(appxFireObjectEvent).css({position:"absolute","z-index":c,"min-width":s.width()}).focus().offset(l),appx_session.objFocus=a}else appx_session.objFocus=$("<select>").val("0"),appxFireObjectEvent()}}catch(u){console.log("appxobjectinvokehandler: "+u),console.log(u.stack)}}function appxFireObjectEvent(){if(appx_session.objFocus&&!appx_session.objEventFired){appx_session.objEventFired=!0
var e=appx_session.objFocus.val()
appx_session.ws.send(JSON.stringify({cmd:"appxmessage",args:hton32(0).concat(hton32(e)),handler:"appxobjectinvokehandler",data:null}))}}function appxobjectdestroyhandler(e){appxSetLocked(!1),setTimeout(function(){appx_session.objFocus=null},250)}$("#btn_appx_login").click(function(){start_session()}),$("#btn_appx_reconnect").click(function(){session_management()}),$("#appx_login_modul input").keyup(function(e){!fixKeyEvent(e)||10!=e.which&&13!=e.which||start_session()}),$("#appx-status-msg").html(""),$(".appx-show-on-load").show(),appxNewSession||appxLoginAutoConnect||($("#appx_login_modul").show(),$("#appx_server").focus()),$(document).ready(function(){localStorage&&localStorage.appx_options&&!localStorage.appx_ls_version&&(localStorage.clear(),localStorage.appx_ls_version="1",window.location.reload())})
