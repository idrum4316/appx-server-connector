/*********************************************************************
 **
 **   server/appx-client-screen.js - Client Screen processing
 **
 **   This module contains code to process client resources.
 **
 *********************************************************************/
"use strict"
function getInputElement(e){return $(e).hasClass("appxdatefield")&&$(e).find(".appxdatevalue")&&(e=$(e).find(".appxdatevalue")),e}function setInputFocus(e){$(e).hasClass("appxdatefield")&&$(e).find(".appxdatevalue")&&(e=$(e).find(".appxdatevalue")),e.focus()}function appxmsgshandler(e){appx_session.msgs=[]
for(;e.data.length>0;){var s=e.data.shift()
if(s.txtlen>0&&s.txtval.indexOf("Building Scan List")<0){var a=$("<span>").html(s.txtval)
switch(a.addClass("status-msg"),s.severity){case 0:a.addClass("status-msg-info")
break
case 1:a.addClass("status-msg-warning")
break
case 2:a.addClass("status-msg-error")
break
case 3:a.addClass("status-msg-cancel")}appx_session.msgs.push(a)}}}function applymessages(){for(var e=$("<div>"),s=0;s<appx_session.msgs.length;s++){var a=appx_session.msgs[s]
s>0&&e.append("<br>"),e.append(a)}$("#appx-status-msg").html(e)}function appxFindBoxIdx(e,s,a,t,n){for(var o=0,p=appx_session.current_show.boxes,r=0;r<p.length;r++){var i=p[r]
s>=i.begin_column&&s<=i.end_column&&e>=i.begin_row&&e<=i.end_row&&e+a-1<=i.end_row&&s+t-1<=i.end_column&&(1==n||0==appxIsScroll(i)&&0==appxIsScrollReg(i))&&(o=r)}return o}function appxfindbox(e,s,a,t,n){for(var o=null,p=appx_session.current_show.boxes,r=0;r<p.length;r++){var i=p[r]
s>=i.begin_column&&s<=i.end_column&&e>=i.begin_row&&e<=i.end_row&&e+a-1<=i.end_row&&s+t-1<=i.end_column&&(1==n||0==appxIsScroll(i)&&0==appxIsScrollReg(i))&&(o=i)}return o}function applyimage(e){if(null!=e){var s=appx_session.image_cache[e].url,a=appx_session.image_cache[e].ctx
switch(a){case 4:case 5:$("#screenBuf ."+e+"_imgRO").attr("srcRO",s)
break
case 7:$("#screenBuf ."+e).css({"background-image":"url('"+s+"')"})
break
default:var t="#screenBuf ."
0===$("#screenBuf").children().length&&(t="#appx_main_container ."),$(t+e+"_pic").css({"background-image":"url('"+s+"')"}),$(t+e+"_ico").css({"background-image":"url('"+s+"')"}),$(t+e+"_img").attr("src",s),s.indexOf("./images/missing.png")!=-1&&$("."+e+"_img").addClass("appx-image-missing"),$(t+"context-menu-icon-"+e).css({"background-image":"url('"+s+"')","background-repeat":"no-repeat","background-size":"auto 90%","margin-left":"10px"}),$("#topMenu ."+e).css({"background-image":"url('"+s+"')"}),$("#appx-toolbar ."+e).css({"background-image":"url('"+s+"')"})}}0==appx_session.pendingResources.length&&0===appx_session.pendingTables?(appxSetStatusStateText(APPX_STATE_READY),screenflipped||appxshowscreen()):appxSetStatusStateText(APPX_STATE_IMAGES)}function applystyles(){try{if(appx_session.applyStylesCount++,appx_session.image_cache)for(var e=0;e<appx_session.image_cache.keys.length;e++){var s=appx_session.image_cache.keys[e]
applyimage(s)}if(appx_session.applyStylesCount>1)return
appxApplyStylesCheckbox(),appxApplyStylesColorPicker(),appxApplyStylesDate(),0===appx_session.pendingResources.length&&appxApplyStylesEditor(),appxApplyStylesHtmlViewer(),appxApplyStylesTable(),appxApplyStylesTitleButtons(),appxApplyStylesSlider(),appxApplyStylesSignature()}catch(a){console.log("applystyles: "+a),console.log(a.stack)}}function appxApplyStylesSignature(){try{$(".signature").click(function(){appx_session.signaturePadID=$(this).attr("id")
var e=$("<div>").addClass("appxsignaturedialog").css({"z-index":2e5}),s=$("<canvas>").addClass("signaturepad")
$(e).append(s),$("body").append(e),$.each($(".appxsignaturedialog"),function(e,s){$(s).dialog({open:function(e,s){$(this).parent().addClass("appx-signature-dialog-parent").position({my:"center",at:"center",of:"#box_0"}),$(this).addClass("appx-signature-dialog"),appx_session.signaturePad=new SignaturePad($(".signaturepad")[0]),setTimeout(function(){var e=Math.max(window.devicePixelRatio||1,1)
$(".signaturepad")[0].width=$(".signaturepad")[0].offsetWidth*e,$(".signaturepad")[0].height=$(".signaturepad")[0].offsetHeight*e,$(".signaturepad")[0].getContext("2d").scale(e,e),appx_session.signaturePad.clear()},0)},close:function(){appx_session.signaturePadID=null,this.remove()}}),$(s).dialog("open")}),$(e).append($("<input id='submitsignature' type='button' value='"+appx_session.language.buttons.submit+"'>").click(function(){function e(e){void 0!==HTMLCanvasElement.prototype.toBlob?$(".signaturepad")[0].toBlob(function(s){appx_session.sigBlob=s,e(s)}):e($(".signaturepad")[0].msToBlob())}appx_session.signaturePad.isEmpty()||($("#main").block({message:"<h1>Uploading file to temporary storage, please wait...</h1>",baseZ:999999,fadeIn:0}),e(function(e){var s="signature.png"+Date.now()
uploadFileToMongo(e,s,function(){$("#"+appx_session.signaturePadID).val("$(sendFile)\\"+s),$("#"+appx_session.signaturePadID).addClass("appxitem dirty"),appx_session.signaturePad.off(),$(".appxsignaturedialog").dialog("close")})}))})),$(e).append($("<input id='clearsignature' type='button' value='"+appx_session.language.buttons.clearSignature+"'>").click(function(){appx_session.signaturePad.clear()})),$(e).append($("<input id='cancelsignature' type='button' value='"+appx_session.language.buttons.cancel+"'>").click(function(){appx_session.signaturePad.off(),$(".appxsignaturedialog").dialog("close")}))})}catch(e){console.log("Signature Pad Error: "+e),console.log(e.stack)}}function appxApplyStylesTitleButtons(){$.each($("#screenBuf .appx-title-button-help"),function(e,s){$(s).click(function(e){e.preventDefault(),appx_session.processhelp=!0,$.each($("#screenBuf .appxfield"),function(e,s){$(s).click(function(e){var s=$(this).data("col"),a=$(this).data("row")
s&&a&&(appxPutCursor(s,a),appx_session.processhelp=!1,appxwidgetcallback(OPT_HELP_ITM))})})})}),$.each($("#screenBuf .appx-title-button-ok"),function(e,s){$(s).click(function(e){e.preventDefault(),appxwidgetcallback(OPT_ENTER)})}),$.each($("#screenBuf .appx-title-button-close"),function(e,s){$(s).click(function(e){e.preventDefault(),appxwidgetcallback(OPT_END)})})}function appxApplyStylesCheckbox(){try{var e=checkBrowser()
$.each($("input[type=checkbox]"),function(s,a){$(a).attr("disabled")?"Edge"==e||"IE"==e||$(a).addClass("disabled").removeAttr("disabled").keypress(function(e){e.preventDefault()}).click(function(e){e.preventDefault()}):$(a).data("checked",$(a).checked).keypress(function(e){var s=$(this)
110==e.keyCode||78==e.keyCode?(s.data("checked",0),s.prop("indeterminate",!1),s.prop("checked",!1),s.val("N"),s.addClass("dirty")):121!=e.keyCode&&89!=e.keyCode||(s.data("checked",2),s.prop("indeterminate",!1),s.prop("checked",!0),s.val("Y"),s.addClass("dirty"))}).click(function(e){var s=$(this)
switch(0==s.data("checked")&&0==s.hasClass("appx-nullok")&&s.data("checked",1),s.data("checked")){case 0:s.data("checked",1),s.prop("indeterminate",!0),s.val(" "),s.addClass("dirty"),s.change()
break
case 1:s.data("checked",2),s.prop("indeterminate",!1),s.prop("checked",!0),s.val("Y"),s.addClass("dirty")
break
default:s.data("checked",0),s.prop("indeterminate",!1),s.prop("checked",!1),s.val("N"),s.addClass("dirty")}})})}catch(s){console.log("appxApplyStylesCheckbox: "+s),console.log(s.stack)}}function appxApplyStylesColorPicker(){try{$.each($("#screenBuf .appxcolorpicker"),function(e,s){$(s).parent().width($(s).parent().width()+2*appx_session.colWidthPx-2),$(s).colpick({layout:"hex",submit:!0,colorScheme:"light",onChange:function(e,s,a,t,n){$(t).css("border-color","#"+s),n||$(t).val(s)},onSubmit:function(e,s,a,t,n){$(t).parent().find("input").css({"border-color":"#"+s,"background-color":"#"+s}),n||$(t).parent().find("input").val(s),$(t).colpickHide()}}).keyup(function(){$(this).colpickSetColor(this.value)}),$(s).parent().find("img").colpick({layout:"hex",submit:!0,colorScheme:"light",onChange:function(e,s,a,t,n){$(t).parent().find("input").css("border-color","#"+s),n||$(t).parent().find("input").val(s)},onSubmit:function(e,s,a,t,n){$(t).parent().find("input").css({"border-color":"#"+s,"background-color":"#"+s}),n||$(t).parent().find("input").val(s),$(t).colpickHide()}})})}catch(e){console.log("appxApplyStylesColorPicker: "+e),console.log(e.stack)}}function appxApplyStylesDate(){try{$.each($("#screenBuf .appxdatefield"),function(e,s){$(s).width($(s).width()+2.5*appx_session.colWidthPx)
var a=$(s).find(".appxdatevalue").first()
a.css({"font-size":appx_session.basefontsize+"px"})
var t=$(s).find(".appxdatepicker").first(),n=JSON.parse(t.val()),o={beforeShow:function(e,s){appx_session.activeDatepicker=$(this)},buttonImage:""+appxClientRoot+"/images/calendar.gif",buttonImageOnly:!0,changeMonth:!0,changeYear:!0,buttonText:"",dateFormat:n.datemsk,onClose:function(e,s){var a=APPX.DateFormatter2(e,s.settings.dateFormat,s.settings.timeFormat),t=$(this).closest(".appxitem").attr("id").split("_")
sendappxdate(parseInt(t[2]),parseInt(t[1]),a)},showButtonPanel:!0,showOn:"button",timeFormat:n.timemsk,yearRange:"1000:3000"}
t.datepicker(o),t.val(n.value),$(s).find("img").css({position:"absolute",right:"2px",top:"2px","z-index":1e5}).click(function(){appx_session.activeDatepicker=$(this)})})}catch(e){console.log("appxApplyStylesDate: "+e),console.log(e.stack)}}function appxApplyStyleEditor(e,s){try{var a=[]
if(s){if($(":data(editorConfig)").each(function(){$(this).data().editorConfig===e&&(a=$(this))}),0===a.length)return}else a[0]=e
for(var t=0;t<a.length;t++){var n=$(a[t])
if(n.attr("id").indexOf("stale")!==-1)return
"disabled"!=n.attr("disabled")&&n.height()>100&&n.css("height",n.height()-100+"px"),n.removeClass("ckeditor")
var o=n.css("left"),p=n.css("top"),r=n.css("width"),i=n.css("height")
if(o=parseInt(o.substring(0,o.length-2)),p=parseInt(p.substring(0,p.length-2)),r=parseInt(r.substring(0,r.length-2)),i=parseInt(i.substring(0,i.length-2)),i<=5*appx_session.rowHeightPx){n.addClass("button_cke")
var l=$("<button>")
l.attr("id","CKE_Button"),l.val("a"),l.text("a"),l.click(function(){n=$(".button_cke")
var e={}
e.customConfig=AppxResource.cache[n.data("editorConfig")],void 0===e.customConfig&&(e.customConfig="../custom/appx-ckeditor-config.js"),e.width=r
var s=n.clone(),a=$("<div>")
a.hide().appendTo(n.parent()),s.hide().appendTo(a),s.css("height",5*i+"px"),s.attr("id","clone")
var t=CKEDITOR.replace(s.attr("id"),e)
s.attr("name",t.name),t.on("instanceReady",function(){$("#cke_"+s.attr("id")).find("iframe").attr("title",""),$("#cke_"+s.attr("id")).css({position:"absolute",height:s.css("height"),"z-index":s.css("z-index")}),setTimeout(function(){t.resize(parseInt(r)-4,parseInt(5*i)+2,!1)},0)}),t.resetDirty(),n.hide(),a.dialog({title:"CKEDITOR",position:{of:"#appx_main_container"},minWidth:r+100,height:6*i+50,buttons:{Ok:function(){n.val(t.getData()),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){s.remove(),n.show(),t.destroy()}})}),l.css({position:"absolute",top:p+"px",left:o+r+5+"px"}),n.hasClass("button_cke")&&"Chg"===$("#appx_status_mode").text()&&l.appendTo(n.parent())}else{var c={},d={}
"disabled"==n.attr("disabled")?(c.customConfig=AppxResource.cache[n.data("editorConfig")],c.removePlugins="elementspath,toolbar",c.allowedContent=!0,c.resize_enabled=!1):(c.customConfig=AppxResource.cache[n.data("editorConfig")],void 0===c.customConfig&&(c.customConfig="../custom/appx-ckeditor-config.js")),c.width=r+"px",c.height=i+"px",d=CKEDITOR.replace(n.attr("id"),c),n.attr("name",d.name)
var x=t
d.on("instanceReady",function(){this.ui.contentsElement.clientHeight=i,$("#cke_"+$(a[x]).attr("id")).find("iframe").attr("title",""),$("#cke_"+$(a[x]).attr("id")).css({position:"absolute",top:p+"px",left:o+"px","z-index":$(a[x]).css("z-index")})}),d.on("paste",function(e){validateInputText(e.data.dataValue,n.data("unicode"))}),d.resetDirty()}}}catch(u){console.log("appxApplyStyleEditor: "+u),console.log(u.stack)}}function appxApplyStylesEditor(){try{for(name in CKEDITOR.instances)CKEDITOR.instances[name].destroy(!0)
for(var e in appx_session.image_cache)10==appx_session.image_cache[e].ctx&&appxApplyStyleEditor(e,!0)
$.each($("#screenBuf .ckeditor"),function(e,s){0===Object.getOwnPropertyNames(CKEDITOR.instances).length&&appxApplyStyleEditor(s,!1)})}catch(s){console.log("appxApplyStylesEditor: "+s),console.log(s.stack)}}function appxApplyStylesHtmlViewer(){try{$.each($("#screenBuf .appx-html-viewer a"),function(e,s){var a=$(s).attr("href")
isNaN(a)||$(s).attr({href:"#"}).click(function(e){return e.preventDefault(),appxwidgetcallback(parseInt(a)),!1})})}catch(e){console.log("appxApplyStylesHtmlViewer: "+e),console.log(e.stack)}}function appxApplyStylesTable(){try{$.each($("#screenBuf .appxtablewidget"),function(e,s){createGridMongo({},$(s).attr("id"))})}catch(e){console.log("appxApplyStylesTable: "+e),console.log(e.stack)}}function appxApplyStylesSlider(){try{$.each($("#screenBuf .slider"),function(e,s){function a(e){var s
return null!=$(".slider").attr("data-tickMajor")&&(s=parseInt($(".slider").attr("data-tickMajor"))),e=s?e%s?0:1:0}var t,n,o,p,r,i,l,c=1,d=1,x="ltr",u={},g=!1,_="horizontal"
if(o=parseInt($(s).attr("data-min")),p=parseInt($(s).attr("data-max")),u.min=[o],u.max=[p],"vertical"===$(s).attr("data-orientation")?_="vertical":$(s).closest(".appx--box").css("top","10px"),null!=$(s).attr("data-tickMajor")&&(t=parseInt($(s).attr("data-tickMajor")),d=t),null!=$(s).attr("data-tickMinor")&&(n=parseInt($(s).attr("data-tickMinor")),d=n),null!=$(s).attr("data-invert")&&"true"==$(s).attr("data-invert")&&(x="rtl"),null!=$(s).attr("data-tickSnap")&&"true"==$(s).attr("data-tickSnap"))g=!0,r=0,n?(c=n,l=p/n+1):t&&(c=t,l=p/t+1)
else if(null!=$(s).attr("data-tickShow")&&"true"==$(s).attr("data-tickShow")&&(n||t))if(g=!0,n){l=p/n+1,r=n/p*100
for(var e=1;e<=p/r;e++){var h=n*e
i=(r*e).toString()+"%",u[i]=[h]}}else if(t){l=p/t+1,r=t/p*100
for(var e=1;e<=p/r;e++){var h=t*e
i=(r*e).toString()+"%",u[i]=[h]}}if(g?noUiSlider.create(s,{start:[parseInt($(s).attr("data-value"))],step:c,range:u,direction:x,orientation:_,pips:{mode:"count",values:l,density:d,filter:a,stepped:!0}}):noUiSlider.create(s,{start:[parseInt($(s).attr("data-value"))],step:c,range:u,direction:x,orientation:_}),null!=$(s).attr("data-modifiable")&&"true"!=$(s).attr("data-modifiable")&&$(s).attr("disabled",!0),"vertical"===$(s).attr("data-orientation")){var f=$(s).closest(".noUiSlider").height()-13
$(s).height(f)}s.noUiSlider.on("change",function(e,a){var t=$(s).closest(".noUiSlider")
parseInt($(s).attr("data-value"))!==parseInt(s.noUiSlider.get())&&t.addClass("dirty"),t.val(parseInt(e[0]))}),null!=$(s).attr("data-tickLabels")&&"false"==$(s).attr("data-tickLabels")&&$("div").remove(".noUi-value")})}catch(e){console.log("appxApplyStylesSlider: "+e),console.log(e.stack)}}function appxattributeshandler(e){}function appxextraattributeshandler(e){}function attachMouseListener(e){e.mousedown(function(e){appx_session.mouseX=e.pageX-parseInt($("#appx_main_container").position().left),appx_session.mouseY=e.pageY-parseInt($("#appx_main_container").position().top)})}function appxscreenhandler(e){var s=""
if(null==$_screenBuf){var a=$("#appx_main_container").empty()
$_screenBuf=a.clone(),$_screenBuf.attr("id","screenBuf"),$_screenBuf.appendTo(a.parent()),$_screenBuf.css("visibility","hidden"),attachMouseListener(a.parent())}$_screenBuf.html("<div id='appx_main_background' style='float:left;width:70%;'>"+s+"</div>"),initializeMenu()}function appxscreenhandlerdata(e){for(var s=[],a="",t=0;e.length>0;){var n=e.shift()
if(logactivity("mask:  "+n),n>255){s=new Array(n)
for(var o=e.shift(),p=0;p<s.length;p++)s[p]=o
e=e.slice(s.length,e.length)}else e=e.slice(1,e.length),t=e.shift()+1,s=e.slice(0,t),a+=ab4str(s),e=e.slice(t,e.length)}return a}function appxMergeBoxes(e,s){for(var a=e.begin_row-s.begin_row,t=e.begin_column-s.begin_column,n=a*appx_session.rowHeightPx,o=t*appx_session.colWidthPx;e.items.length;){var p=e.items.shift(),r=p[0],i=p[1]
r.pos_row+=a,r.pos_col+=t,i&&i.css({top:parseInt(i.css("top"))+n+"px",left:parseInt(i.css("left"))+o+"px"}),s.items.push(p)}for(;e.widgets.length;){var l=e.widgets.shift(),c=l[0],i=l[1]
c.wPositionY+=a,c.wPositionX+=t,i&&i.css({top:parseInt(i.css("top"))+n+"px",left:parseInt(i.css("left"))+o+"px"}),s.widgets.push(l)}for(;e.rowtext.length;){var d=e.rowtext.shift()
d.pos_row+=a,d.pos_col+=t,s.rowtext.push(d)}}function appxHandleEmBox(){for(var e=0;e<appx_session.current_show.boxes.length;e++){var s=appx_session.current_show.boxes[e]
if(appxIsEmBuild(s))return $("#appx_status_date").html(s.widget.wLabel),!0}return!1}function appxshowboxes(){try{var e=null,s=null,a=null,t=0,n=null,o=appxGetCellSize(),p=appxGetCursorPos(),r=!1,i=0,l=null
appx_session.topbox=null,appx_session.tablist=null
for(var c=0;c<appx_session.current_show.boxes.length;c++){inProgressBox=null
var d=appx_session.current_show.boxes[c]
appxIsInProgress(d)&&(inProgressBox=d),0==d.begin_row&&0==d.end_row||(d.end_row>appx_session.screenrows-3&&(d.end_row=appx_session.screenrows-3),d.end_column>appx_session.screencols&&(d.end_column=appx_session.screencols),null!=e&&appxIsScrollReg(d)&&appxIsScrollAct(d)&&appxIsScroll(e)&&1==d.begin_row&&1==d.begin_column&&d.begin_row==e.begin_row&&d.end_row==e.end_row&&d.begin_column==e.begin_column&&d.end_column==e.end_column&&(d.newbox=c-1,d.bit_mask&=~SCROLL_REG,d.bit_mask&=~SCROLL_ACT,e.bit_mask&=~SCROLL,appxMergeBoxes(d,e),a=null,s=null,e=null),appxIsScrollReg(d)?(a=null,s=null,e=null):(a=s,s=e,e=d),null!=a&&a.begin_column==s.begin_column&&s.begin_column==e.begin_column&&a.end_column==s.end_column&&s.end_column==e.end_column&&e.end_row>=s.begin_row-1&&a.end_row>=e.begin_row-1&&appxIsScroll(e)&&(a.begin_column===s.begin_column&&a.end_column==s.end_column&&a.begin_column===s.begin_column&&a.end_column==s.end_column&&a.data_length<s.data_length?(a.newbox=c-2,s.scrollrow=e.begin_row-(s.begin_row-1)):(a.end_row=s.end_row,s.newbox=c-2,appxMergeBoxes(s,a),a.scrollrow=e.begin_row-(a.begin_row-1))),null!=s&&s.begin_column<=e.begin_column&&s.data.indexOf("SWBC=")===-1&&s.end_column>=e.end_column&&s.begin_row-1<=e.end_row&&s.end_row>=e.begin_row-1&&(appxIsScroll(e)?s.scrollrow=e.begin_row-(s.begin_row-1):0==Math.abs(e.bit_mask&BORD_AROUND)&&null==e.widget.wIconWallpaper&&null==e.widget.wColorBgWallpaper&&null==e.widget.wBorder&&null==e.widget.wLabel&&null==e.widget.wBorder&&(s.end_row<e.end_row&&(s.end_row=e.end_row),e.newbox=c-1,l=null===a?e.newbox:e.newbox-1,appxMergeBoxes(e,s),e=s,s=a)),appxIsScroll(d)||appxIsScrollReg(d)||(i=null!==l?l:c))}appx_session.current_show.boxes[i]&&appx_session.current_show.boxes[i].hasOwnProperty("newbox")&&(i=appx_session.current_show.boxes[i].newbox),appx_session.topboxid=i
for(var x=0,u=0,c=0;c<appx_session.current_show.boxes.length;c++){var d=appx_session.current_show.boxes[c]
if((1074003968!=d.bit_mask||null!=d.items[0]||null!=d.widgets[0]||null!=d.rowtext[0]||0!=Math.abs(d.bit_mask&BORD_AROUND)||null!=d.widget.wIconWallpaper||null!=d.widget.wColorBgWallpaper||null!=d.widget.wBorder||null!=d.widget.wLabel)&&!(appxIsEmBuild(d)||0==d.begin_row&&0==d.end_row||appxIsInProgress(d)||d.newbox>=0)){if(appxIsScroll(d)&&(x=t),u=appxIsScrollReg(d)?1e3*(x+1):1e3*(t+1),d.layer=u,!appxIsScroll(d)&&!appxIsScrollReg(d)&&d.rowtext&&d.rowtext.length>0){for(var g="",_=0;_<d.rowtext.length;_++){var h=d.rowtext[_]
1==h.pos_row&&(g+=h.string.trim()+" ",h.isTitle&&(h.string=""))}g.length>0&&null==d.widget.wLabel&&(d.widget.wLabel=g)}var f=(d.end_column-d.begin_column)*o.w+3*o.w+2,w=(d.end_row-(d.begin_row-1))*o.h+1*o.h
appxIsScroll(d)?w-=1*o.h-4:w+=1*o.h,w>=document.documentElement.clientHeight&&d.data.indexOf("SBN=0")>-1&&"Firefox"===checkBrowser()&&(w+=appx_session.rowHeightPx)
var b=d.begin_row*o.h-o.h,m=d.begin_column*o.w-o.w
if(!appxIsScroll(d)&&!appxIsScrollReg(d)){var v=($("#appx_main_container").height()-w)/2
if((0===c||v>appx_session.centerVerticalOffset)&&(appx_session.centerVerticalOffset=v),0==d.widget.specialHorizontalLocation&&(m=0),0==d.widget.specialVerticalLocation&&(b=0,c>0)){var y=d.end_row-d.begin_row,S=appx_session.current_show.boxes[c-1].end_row-appx_session.current_show.boxes[c-1].begin_row
y<=S&&(b=appx_session.centerVerticalOffset)}}var k=$("#appx_main_container").width(),T=(k-f)/2
if(T<0&&(T=0),(0===c||T<appx_session.centerHorizontalOffset)&&appx_session.getProp("centerAppx")){var C=appx_session.centerHorizontalOffset
appx_session.centerHorizontalOffset=T
for(var _=0;_<c;_++){var I=appx_session.current_show.boxes[_],P=$("#box_"+I.widget.wBoxNumber.toString())
if(P.length){var O=P.position().left-C
O<0&&(O=0),P.css({left:O+appx_session.centerHorizontalOffset+"px"})}}}T>appx_session.centerHorizontalOffset&&!appxIsScroll(d)&&!appxIsScrollReg(d)&&0==d.widget.specialHorizontalLocation?T-=appx_session.centerHorizontalOffset:T=0,appxIsScroll(d)&&(m+=3,f-=6),appxIsScrollReg(d)&&(m+=3,f-=6)
var A=null
if(d.widget.wLabel&&""!=d.widget.wLabel){var E=2,R=E,B=E,M=f-4*E+"px",D=o.h+"px"
"true"==appxFillWindow&&d.end_column-d.begin_column+1==appx_session.screencols&&(M="100%",R="0px",B="0px")
var A=$("<div>").css({border:"0px","box-sizing":"border-box",display:"table",height:D,left:B,overflow:"hidden",position:"absolute",top:R,width:M,"z-index":u+1})
A.addClass("appx-title"),A.attr("id","box_2_"+d.widget.wBoxNumber.toString()),A.data("row",d.widget.wPositionY),A.data("col",d.widget.wPositionX),d.widget.isBox=!1,appxwidgetshandlerpropsex(d.widget,A,!0)}m=m+T+appx_session.centerHorizontalOffset+"px","true"==appxFillWindow&&1==d.begin_row&&1==d.begin_column&&d.end_row==appx_session.screenrows-3&&d.end_column==appx_session.screencols&&(f="100%")
var U=$("<div>").css({"box-sizing":"border-box",height:w,left:m,overflow:"hidden",position:"absolute",top:b,width:f,"z-index":u})
if(A&&U.append(A),U.addClass("appxbox"),U.attr("id","box_"+d.widget.wBoxNumber.toString()),U.data("row",d.widget.wPositionY),U.data("col",d.widget.wPositionX),U.attr("data-role","content"),1==d.begin_row&&1==d.begin_column&&d.end_row==appx_session.screenrows-3&&d.end_column==appx_session.screencols&&U.addClass("appxbox-full"),d.widget.isBox=!0,appxwidgetshandlerprops(d.widget,U),$_screenBuf.append(U),p.row>=d.begin_row&&p.row<=d.end_row&&p.col>=d.begin_column&&p.col<=d.end_column&&(null==_boxcur||_boxcur.end_row-_boxcur.begin_row>=d.end_row-d.begin_row||_boxcur.end_column-_boxcur.begin_column>=d.end_column-d.begin_column)&&0==Math.abs(d.bit_mask&SCROLL)&&(_boxcur=d,n=U),!(d.end_column-d.begin_column+1>=appx_session.screencols&&d.end_row-d.begin_row+1>=appx_session.screenrows-3))if(appxIsScroll(d))U.addClass("appx-scroll"),U.css("top",b+o.h)
else if(appxIsScrollReg(d)){for(var N,L=U.siblings(".appx-scroll"),_=0;_<L.length;_++)$(L[_]).zIndex()===U.zIndex()&&(N=$(L[_]))
if(N)var z=parseInt(N.css("top").substring(0,N.css("top").indexOf("px"))),F=parseInt(N.css("left").substring(0,N.css("left").indexOf("px"))),W=parseInt(m.substring(0,m.indexOf("px"))),G=Math.abs(z-(b+o.h)),X=F-W,H=N.width()
appxIsScrollAct(d)?(U.addClass("appx-scroll-act"),U.removeClass("appxbox"),r=!0):r?(r=!1,U.removeClass("appxbox"),U.addClass("appx-scroll-act-next")):(U.addClass("appx-scroll-reg"),U.removeClass("appxbox")),U.appendTo(N),U.data("col",d.begin_column),U.data("row",d.begin_row),U.click(function(){appxScrollClick($(this).parent())}),U.css({top:G,left:X,width:H}),U.height(w-2*o.h)}else d.widget.wBorder||U.addClass("appx-border-bevel-raised")
if(d.widget.wMovable&&(U.data({wMovableCommand:d.widget.wMovableCommand}),U.draggable({cancel:".appx-modifiable, .ui-pg-input, .ui-pg-selbox",drop:function(){var e=Math.floor(($(this).offset().top-$("#appx_main_container").offset().top)/appx_session.rowHeightPx),s=Math.floor(($(this).offset().left-$("#appx_main_container").offset().left)/appx_session.colWidthPx)
appxPutCursor(s,e),$(this).data("wMovableCommand")&&appxwidgetcallback($(this).data("wMovableCommand"))}})),$("a").each(function(){$(this).attr("tabindex",-1)}),$("button").each(function(){$(this).attr("tabindex",-1)}),appxIsScroll(d)||appxIsScrollReg(d))var Y=appxFindBoxIdx(d.begin_row,d.begin_column,d.end_row-d.begin_row+1,d.end_column-d.begin_column+1,!1)
else{Y=c
for(var J=!0,_=c+1;_<appx_session.current_show.boxes.length;_++)appx_session.current_show.boxes[_].hasOwnProperty("newbox")||appxIsScroll(appx_session.current_show.boxes[_])||appxIsScrollReg(appx_session.current_show.boxes[_])||(J=!1)
J&&(i=c)}appxshowrowtextforbox(d),appxshowitemsforbox(d,i==Y),appxshowwidgetsforbox(d,i==Y),appxIsScroll(d)||appxIsScrollReg(d)||i!=c&&U.addClass("appx-not-modifiable"),t++}}if(inProgressBox&&!blocked)try{blocked=!0
var V=inProgressBox.widget.wlabel
V||(V="In Progress"),$("#main").block({message:V+"...",overlayCSS:{backgroundColor:null,opacity:null,cursor:"wait"},centerY:!1,css:{"z-index":1e4},blockMsgClass:"appx-in-progress-msg"})}catch(K){}}catch(j){console.log("appxshowboxes: "+j),console.log(j.stack)}}function appxshowcursor(e){try{var s=appxGetCellSize(),a=appxGetCursorPos()
if(!e){var t=!1,n=appxfindbox(a.row,a.col,1,1,!0)
if(!n)return
var o=$("#appxCursor"),p=null
0==o.length&&(o=$("<div>"),o.attr("id","appxCursor"),o.css({"background-color":"rgba(0,0,0,.5)",height:s.h,position:"absolute",width:s.w,"z-index":"100000"}),$("#appx_main_container").append(o))
var r=a.col*s.w+appx_session.centerHorizontalOffset
appxIsScrollReg(n)&&(r-=3)
var i=a.row*s.h
o.css({left:r+"px",top:i+"px"}),$(".appx-scroll-act-new").removeClass("appx-scroll-act-new"),appxIsScrollReg(n)&&!appxIsScrollAct(n)&&$("#box_"+n.widget.wBoxNumber.toString()).addClass("appx-scroll-act-new")
for(var l=0;l<n.items.length;l++){var c=n.items[l]
if(null!=c[1]){var d=c[1][0]
if(c[0].hasOwnProperty("pos_row")){null==p&&appxIsModifiable(c[0])&&(p=c)
var x=0
appx_session.keyLeft&&(x=1)
var u={row:a.row-n.begin_row+1,col:a.col-n.begin_column+1}
if(appxIsModifiable(c[0])&&u.row>=c[0].pos_row&&u.row<=c[0].pos_row+c[0].size_rows-1&&x+u.col>=c[0].pos_col&&u.col<=c[0].pos_col+c[0].size_cols-1){t=!0,setInputFocus(d)
break}}}}return o.css("visibility",t||appxIsLocked()||"true"!=appx_session.getProp("drawBlockCursor")&&!appx_session.showCursor?"hidden":"visible"),t}var g=$("#appxitem_"+a.col+"_"+a.row)
0!==g.length&&g.hasClass("appx-modifiable")||(g=$(".appx-modifiable").first()),void 0!==g[0]&&setInputFocus(g[0])}catch(_){console.log("appxshowcursor: "+_),console.log(_.stack)}}function appxnestwidgets(){var e={}
try{for(var s=0;s<appx_session.current_show.boxes.length;s++){var a=appx_session.current_show.boxes[s]
a.widget=new Widget(0,"",a.data),a.widget&&(e[a.widget.wBoxNumber]=s)}}catch(t){console.log("appxidboxes: "+t),console.log(t.stack)}try{for(var s=0;s<appx_session.items.length;s++){var n=appx_session.items[s][0],a=appxitembox(n.pos_row,n.pos_col,n.size_rows,n.size_cols),o=appx_session.items[s][1]
if(appxIsScroll(a)||appxIsScrollReg(a)){if(o){var p=(a.begin_row-n.pos_row)*appx_session.rowHeightPx
o.css({top:p+"px"})}}else{n.init_pos_row=n.pos_row,n.init_pos_col=n.pos_col,n.pos_row-=a.begin_row-1,n.pos_col-=a.begin_column-1
var r=n.pos_row*appx_session.rowHeightPx,i=n.pos_col*appx_session.colWidthPx
o&&o.css({top:r+"px",left:i+"px"})}a&&a.items.push(appx_session.items[s])}appx_session.items=[]
for(var s=0;s<appx_session.widgets.length;s++){var l=appx_session.widgets[s],c=l[0],d=l[0].boxid,x=e[d],a=appx_session.current_show.boxes[x]
if(!appxIsFullscreen(a)&&appxIsScroll(a)){var o=l[1],u=a,a=appxitembox(u.begin_row+c.wPositionY-1,u.begin_column+c.wPositionX-1,c.wSizeH,c.wSizeW),g=a.begin_row-u.begin_row+1,_=a.begin_column-u.begin_column
o.css({top:parseInt(o.css("top"))-g*appx_session.rowHeightPx+"px",left:parseInt(o.css("left"))-_*appx_session.colWidthPx+"px"}),o.data("row")&&o.data("row",o.data("row")+(u.begin_row-1)),o.data("col")&&o.data("col",o.data("col")+(u.begin_column-1))}a?a.widgets.push(appx_session.widgets[s]):console.log("appxnestwidgets() failed to find box for widget")}appx_session.widgets=[]
for(var s=0;s<appx_session.rowtext.length;s++){var h=1,f=appx_session.rowtext[s]
if(f.type==ROWTEXT_TYPE_ITEM)a=appxitembox(f.pos_row,f.pos_col,f.size_rows,f.size_cols)
else{var w=f.boxid,b=e[w]
if(b>=0){var a=appx_session.current_show.boxes[b]
if(!appxIsFullscreen(a)&&appxIsScroll(a)){var u=a
a=appxitembox(u.begin_row+f.pos_row-1,u.begin_column+f.pos_col-1,f.size_rows,f.size_cols),h=u.begin_row}}}appxIsScroll(a)||appxIsScrollReg(a)?(f.pos_row-=a.begin_row-h,f.pos_col-=a.begin_column-1):f.type==ROWTEXT_TYPE_ITEM&&(f.pos_row-=a.begin_row-1,f.pos_col-=a.begin_column-1),a.rowtext.push(f)}appx_session.rowtext=[]}catch(t){console.log("appxnestwidgets: "+t),console.log(t.stack)}}function appxshowhandler(e){try{if(null==e||null==e.data)return
appx_session.current_show=e.data
var s=appx_session.current_show
s.curraction[0]
if($("#appx_main_container *").each(function(){var e=$(this).attr("id")+"-stale"
$(this).attr("id",e)}),appxnestwidgets(),appxHandleEmBox()?appx_session.buildingEm=!0:$("#appx_status_date").html(""),appx_session.buildingEm||(appxshowboxes(),appxprepscreen(),setTimeout(function(){appxSetTabIndexes()},0)),AppxResource.sendHeld(),screenflipped=!1,(0==appx_session.pendingResources.length&&0===appx_session.pendingTables||0==Math.abs(s.curraction[0]&M_WAIT))&&appxshowscreen(),0!=Math.abs(s.curraction[0]&M_SAVE)&&(appx_session.dirtySinceSave=!1),0==Math.abs(s.curraction[0]&M_WAIT)&&0==appx_session.pendingResources.length)sendappxshow(0,[])
else{$(document).tooltip(),blocked=!1
try{$("#main").unblock()}catch(a){}appxstarttimeout(),appxSetStatusStateText(0==appx_session.pendingResources.length&&0===appx_session.pendingTables?APPX_STATE_READY:APPX_STATE_IMAGES)}1==appx_session.processhelp&&(appx_session.processhelp=!1,setTimeout(function(){appxwidgetcallback(appx_session.processhelpoption),appx_session.processhelpoption=null},0)),!appx_session.buildingEm||0!==$("#appx_status_date").text().length&&$("#appx_status_date")||(appx_session.buildingEm=!1,appx_session.pendingTables=0)}catch(t){console.log("appxshowhandler: "+t),console.log(t.stack)}}function appxshowrowtextforbox(e){for(var s=0,a=0,t=0,n=0,o=e.rowtext.length-1;o>-1;o--){var p=e.rowtext[o],r=e.widget.wBoxNumber
if(1!=p.pos_row||"Standard Toolbars"!=p.string.trim())if(p.string&&p.string.length>1&&"="==p.string[0]&&e.scrollrow&&e.scrollrow==p.pos_row+1)a=p.pos_row
else if(a>0&&a==p.pos_row+1&&(t=p.pos_row,p.pos_row++),a>0&&t>0&&a==p.pos_row+2&&(n=p.pos_row,p.pos_row++),p.pos_row>0){if(1==p.pos_row&&e.widget&&e.widget.wLabel&&e.widget.wLabel.trim()==p.string.trim())continue
s++
var i=0,l=0,c=0,d=0,x=appx_session.colWidthPx,u=appx_session.rowHeightPx
e&&appxIsScrollReg(e)&&(i=1,l=1),i=(p.pos_col-i)*x,l=(p.pos_row-l)*u,c=p.size_cols*x+5,d=p.size_rows*u
var g=$("<div>")
p.size_rows>1?p.wordWrap?g.addClass("rowtextwrap"):g.addClass("appx-alpha-field"):g.addClass("rowtext"),p.type==ROWTEXT_TYPE_ITEM&&g.addClass("rowtextitem"),p.uline&&g.addClass("appx-uline"),p.string.length>1&&"="==p.string[0]&&g.addClass("ColHdgSep"),g.attr("id","rowtext_"+s.toString()),g.text(p.string.replace(/[\xb6\x0d\x0a]/g," ")),g.css({margin:"0",padding:"0"}),g.css({position:"absolute",left:i,top:l,height:d,width:c,"z-index":-20})
for(var _=0;_<e.items.length;_++){var h=e.items[_]
if(4===h.length&&h[3]===p){e.items[_][1]=g
break}}if(null!=e){var f=$("#screenBuf #box_"+r)
f.length&&f.append(g)}}}}function appxshowitemsforbox(e,s){for(var a=e.items.length-1;a>=0;a--){var t=e.items[a][0],n=null
if(a>0&&(n=e.items[a-1][0]),null!=e.items[a][1]){var o=0
appxIsScrollReg(e)||(o=e.begin_row)
var p=e.items[a][1],r=$_screenBuf
s&&appxSetTabElement(t,p),appxIsModifiableCapable(t)&&appxIsScrollReg(e)&&p.removeClass("appx-not-modifiable")
var i=e.widget.wBoxNumber
appxwidgetdimensions(t,p,e)
var l=$("#screenBuf #box_"+i)
if(l.length?r=l:console.log("no box..."),appxIsScrollReg(e)&&(appxIsModifiable(t)||p.click(function(){appxScrollClick($(this).parent())})),p.is("select")&&navigator.userAgent.indexOf("Mobile")===-1){var c=parseInt(p.css("width")),d=parseInt(p.css("left")),x=d+c,u=parseInt(p.css("top")),g=null
a-1>=0&&(g=e.items[a-1][1])
var _=parseInt(r.css("width"))-4,h=_<x
if(g||h){appxwidgetdimensions(n,g,e)
var f=_,w=!0
if(h||(f=parseInt(g.css("left")),w=u===parseInt(g.css("top"))),w&&x>f){var b=p.attr("data-padWidth"),m=c-b,v=x-b,y=5*appx_session.colWidthPx
if(v<f&&m>y){var S=h?5:1,k=f-S-d+"px"
p.width(k)}else{var T={}
$.each(p[0].attributes,function(e,s){T[s.nodeName]=s.nodeValue}),p=$("<input type='text' />")
for(var C in T)p.attr(C,T[C])
var k=appx_session.colWidthPx*t.size_cols+5+"px"
p.css({width:k})}}}}if(e.items[a].length<4){r.append(p)
var I=10
null===t.widget.wLayer&&void 0===t.widget.wLayer||(I=t.widget.wLayer),p.css("z-index",e.layer+I*-1)}if(appxIsScannable(t)){var P=appxGetCellSize(),O=1,A=t.pos_col*P.w,d=parseInt(p.css("left")),E=A-d,R=d+parseInt(p.css("width"))+O,B=R+9,M=parseInt(p.css("top"))+4,D=!0
if(n){var f=n.pos_col*P.w-E
t.pos_row*P.h
t.pos_row==n.pos_row&&(R>=f||B>=f)&&(D=!1)}if(D){var U=t.widget.wPositionX,N=t.widget.wPositionY
null===U&&(U=t.pos_col,N=t.pos_row),$("<img>").attr("src",""+appxClientRoot+"/images/scanicon.png").data({col:U,row:N}).css({left:R,position:"absolute",top:M,"z-index":p.css("z-index")}).mousedown(function(){appx_session.scan=!0,appxPutCursor($(this).data().col,$(this).data().row),appxSnapshotScanCursor(),appxwidgetcallback(OPT_SCAN)}).appendTo(r)}}}}}function appxshowscreen(){if(!screenflipped){if(screenflipped=!0,!appx_session.buildingEm){var e=$("#appx_main_container")
e.attr("id","screenBuf"),$_screenBuf.attr("id","appx_main_container"),$_screenBuf.enhanceWithin&&$_screenBuf.enhanceWithin(),$_screenBuf.css("visibility","visible"),e.css("visibility","hidden"),e.empty(),$_screenBuf=e,appxshowcursor(!0),callValidateText()}setTimeout(function(){appxSetLocked(!1)},0)}}function appxprepscreen(){if(createDropDownMenu(),createPopupMenu(),createToolbarMenu(),applymessages(),$(".temp").each(function(){this.remove()}),$.contextMenu("destroy"),$("*").unbind("contextmenu"),!$.isEmptyObject(appx_session.currentmenuitems.popupItems)){for(var e in appx_session.currentmenuitems.popupItems)if(void 0!==appx_session.currentmenuitems.popupItems[e].icon){var s=appx_session.currentmenuitems.popupItems[e].icon,a=appx_session.image_cache[s].wIcon.substring(1,appx_session.image_cache[s].wIcon.lastIndexOf(",")).replace(",","."),t=appx_session.appxResourceUrl+a,n=$("<style>")
n.attr("type","text/css"),n.html(".context-menu-icon-"+s+" { background-image: url("+t+"); background-repeat: no-repeat; background-size: contain;}"),n.addClass("temp"),n.appendTo($("head")[0])}$.contextMenu({selector:".context-selector",zIndex:2e4,items:appx_session.currentmenuitems.popupItems}),$(":input").contextmenu(!1)}if(applystyles(),appx_session.token_cache)for(var o=0;o<appx_session.token_cache.keys.length;o++){var e=appx_session.token_cache.keys[o]
if(""!=e){if(!appxtokengetitem(e))continue
applyToken(e)}}if(1==appx_session.getProp("showScrollbar")){var p=0
$.each($("#screenBuf .appx-scroll"),function(e,s){p++
var a=($(s).css("z-index"),$("<div id='appx-group-vcr-"+p+"'>").addClass("appx-vcr-group")),t=$("<div id='appx-scroll-vcr-"+p+"'>").addClass("appx-vcr").css({left:parseInt($(s).css("width"))-16+"px",height:$(s).css("height")}),n=Math.max(parseInt($(s).css("height"))-96,16)-0
a.html(""),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-up3").click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_SCROLL_FIRST),!1})),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-up2").click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_SCROLL_PREV),!1})),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-up1").click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_SCROLL_DOWN),!1})),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-scan").css({height:n+"px"}).click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_KEY_ENTRY),!1})),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-down1").click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_SCROLL_UP),!1})),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-down2").click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_SCROLL_NXT),!1})),a.append($("<button type='button'>").addClass("appx-vcr-btn").addClass("appx-vcr-down3").click(function(e){return e.preventDefault(),appxwidgetcallback(OPT_SCROLL_LAST),!1})),t.html(a),$(this).append(t)})}}function clearBoxRowText(e){var s=parseInt(e.css("left").substring(0,e.css("left").length-2)),a=parseInt(e.css("width").substring(0,e.css("width").length-2))+s,t=parseInt(e.css("top").substring(0,e.css("top").length-2)),n=parseInt(e.css("height").substring(0,e.css("height").length-2))+t
$(".rowtext").not(".wait").each(function(){var e=parseInt($(this).css("left").substring(0,$(this).css("left").length-2)),o=parseInt($(this).css("width").substring(0,$(this).css("width").length-2))+e,p=parseInt($(this).css("top").substring(0,$(this).css("top").length-2)),r=parseInt($(this).css("height").substring(0,$(this).css("height").length-2))+p
e<a&&o>s&&p<n&&r>t&&$(this).remove()})}function appxshowwidgetsforbox(e,s){for(;e.widgets.length>0;){var a=e.widgets.shift(),t=a[1],n=a[0],o=e.widget.wBoxNumber
parseInt(n.wWidgetType)==WIDGET_TYPE_ROWTEXT&&"="==n.wLabel[5]||(parseInt(n.wWidgetType)!=WIDGET_TYPE_BOX&&clearBoxRowText(t),$("#screenBuf #box_"+o).append(t),a[0].wMovable&&(t.data({wMovableCommand:a[0].wMovableCommand}),t.draggable({cancel:!1,stop:function(){var e=Math.floor(($(this).offset().top-$("#appx_main_container").offset().top)/appx_session.rowHeightPx),s=Math.floor(($(this).offset().left-$("#appx_main_container").offset().left)/appx_session.colWidthPx)
appxPutCursor(s,e),$(this).data("wMovableCommand")&&appxwidgetcallback($(this).data("wMovableCommand"))}})),s&&parseInt(a[0].wWidgetType)==WIDGET_TYPE_BUTTON?appxSetTabElement(n,t):(t.is("fieldset")||t.attr("tabindex",-1),parseInt(a[0].wWidgetType)!=WIDGET_TYPE_BUTTON||t.parent().hasClass("appx-scroll-act")||(t.prop("disabled",!0),t.css({color:""})),t.removeClass("default")))}}function appxSetTabElement(e,s){try{if(e&&s){var a=function(e){if(!e||0!=e.wEnabled){appx_session.tablist||(appx_session.tablist=[])
var a=appx_session.tablist,t=e?parseInt(e.wTabGroup):0,n="grp-"+(e?e.wTabSubGroupId||"0":"0")
isNaN(t)&&(t=0),"grp-0"==n&&e.wWidgetType==WIDGET_TYPE_BUTTON&&(n="grp-dfltButtons")
var o={grp:n,tag:s}
a[t]=a[t]||[],a[t][n]||(a[t][n]=[]),a[t][n].push(o)}}
e.hasOwnProperty("wWidgetType")?parseInt(e.wWidgetType)==WIDGET_TYPE_BUTTON&&a(e):e.hasOwnProperty("widget")&&e.widget&&appxIsModifiable(e)&&(s.prop("disabled")||a(e.widget))}}catch(t){console.log("appxSetTabElement: "+t),console.log(t.stack)}}function appxSetTabFocus(e,s,a){try{var t=parseInt(e.attr("tabindex"))%100,n=appx_session.tablist,o=n[t]
if(o.hasClass("appxdatefield")&&o.find(".appxdatevalue")&&(o=o.find(".appxdatevalue")),s&&o.blur(),t=s?--t:++t,t<0?t=n.length-1:t>=n.length&&(t=0),o=n[t],o.is("button")&&a&&$("button.default").length>0)o=$("button.default")
else if(o.is("button")&&a)return
setInputFocus(o)}catch(p){console.log("appxSetTabFocus: "+p),console.log(p.stack)}}function appxSetTabIndexes(){try{if(appx_session.tablist){for(var e=[],s=function(s,a){"none"!==s.css("display")&&(e.push(s),s.attr("tabindex",a+(e.length-1)),s.on("keydown",function(e){var s=this
if(e.which==appx_session.getProp("mapTabKey"))appxSetTabFocus($(s),e.shiftKey)
else if(13==e.which&&$(s).is("button"))$(s).trigger("click")
else if(!appxIsLocked())return!0
return e.preventDefault(),e.stopPropagation(),!1}),s.is("button")||s.on("keyup",function(e){try{if(!e.altKey&&!e.ctrlKey&&!e.metaKey){var s=e.which
if(s>46&&(s<91||s>93)&&(s<112||s>125)){var a=$(this).attr("maxlength"),t=appx_session.getProp("autoTabOut"),n=getInputElement(this)
if(a&&t){var o=!1,p=getCursorPosition($(n))
p>-1?a<=p&&(o=!0):$(n).hasClass("appxdatevalue")?a<=$(n).val().replace(/_/g," ").trim().length&&(o=!0):a<=$(n).val().trim().length&&(o=!0),o&&appxSetTabFocus($(this),!1,!0)}}}}catch(r){alert(appx_session.language.alerts.keypressError+r),console.log(r.stack)}return!0}))},a=function(e,s){var a=e.tag.position(),t=s.tag.position()
return a.top=parseInt(e.tag.css("top")),a.left=parseInt(e.tag.css("left")),t.top=parseInt(s.tag.css("top")),t.left=parseInt(s.tag.css("left")),a.top<t.top?-1:a.top>t.top?1:a.left<t.left?-1:a.left>t.left?1:0},t=appx_session.tablist,n=[],o=[],p=0;p<t.length;p++){var r=0
if(t[p]){for(var i in t[p])t[p][i].sort(function(e,s){return!e.tag.is("button")&&s.tag.is("button")?1:e.tag.is("button")&&!s.tag.is("button")?-1:a(e,s)}),t[p][i].sort(a),n[r++]=t[p][i][0]
for(var i in t[p])for(var l in t[p])if(i!==l&&"grp-dfltButtons"!==l&&a(t[p][i][0],t[p][l][0])>0&&a(t[p][i][t[p][i].length-1],t[p][l][t[p][l].length-1])<0){for(var c=t[p][l].length,d=0,x=l+"-split",u=0;u<t[p][l].length;u++)if(a(t[p][i][0],t[p][l][u])<0){d=u
break}t[p][x]=t[p][l].splice(d,c-d)
for(var u=0;u<t[p][x].length;u++)t[p][x][u].grp=x
n[n.length]=t[p][x][0]}n.sort(a)
for(var i in t[p]){var g=[],_=[]
if("grp-dfltButtons"===i&&n.length>1){var h=n[0]
"grp-dfltButtons"===h.grp&&(h=n[1])
for(var u=0;u<t[p][i].length;u++)a(h,t[p][i][u])<1?g.push(t[p][i][u]):_.push(t[p][i][u])
t[p][i]=g.concat(_),t[p][i].tabGrp=2e3,o.push(t[p][i].tabGrp)}else for(var u=0;u<n.length;u++)if(n[u]==t[p][i][0]){t[p][i].tabGrp=100*u,o.push(t[p][i].tabGrp)
break}}o.sort(numberSort)
for(var u=0;u<o.length;u++)for(var i in t[p])if(t[p][i].tabGrp===o[u])for(var f=0;f<t[p][i].length;f++)s(t[p][i][f].tag,t[p][i].tabGrp)}}appx_session.tablist=e}}catch(w){console.log("appxSetTabIndexes: "+w),console.log(w.stack)}}function sendappxshow(e,s){appx_session.buildingEm||clearAndReset(),appx_session.showCursor=!1,appxSetStatusStateText(APPX_STATE_BUSY)
try{if(appx_session.buildingEm||$(".appxtablewidget").each(function(){var e=$(this).attr("id")
AppxTable.updateTableFromGrid(e)
for(var s=AppxTable.getSelections(e),a=[],t=0;t<s.length;t++)a.push(s[t])
$(this).data("selkeys",a)}),appxIsLocked()&&0!=e&&65535!=e)return
appx_session.applyStylesCount=0,appx_session.currenttabledata=[],appxSetLocked(!0),appxstoptimeout(),appx_session.override=!1
var a=[],t=appx_session.current_show
if(null!=t){var n=t.rawdata[4]
e>=0&&(t.rawdata[35]=1)
var o=new DataView(new Uint8Array(t.rawdata).buffer),p=appxGetCursorPos()
if(o.setUint32(12,p.row),o.setUint32(16,p.col),o.setUint32(28,parseInt(e)),2!=n&&32!=n||(o.setUint32(32,parseInt("8")),o.setUint32(28,parseInt("65535"))),o.setInt32(44,0),o.setInt32(48,0),o.setUint32(52,0),t.altuseroption&&appx_session.scan){var r=0,i=0
r=o.getUint32(12),i=new DataView(new Uint8Array(t.altcursorrow).buffer).getUint32(0),o.setUint32(12,i),o.setUint32(44,r),r=o.getUint32(16),i=new DataView(new Uint8Array(t.altcursorcol).buffer).getUint32(0),o.setUint32(16,i),o.setUint32(48,r),r=o.getUint32(28),i=new DataView(new Uint8Array(t.altuseroption).buffer).getUint32(0),o.setUint32(28,i),o.setUint32(52,r),t.altuseroption=null,t.altcursorrow=null,t.altcursorcol=null}else if(t.altuseroption){var r=0,i=0
r=o.getUint32(12),i=new DataView(new Uint8Array(t.altcursorrow).buffer).getUint32(0),o.setUint32(12,i),o.setUint32(44,r),r=o.getUint32(16),i=new DataView(new Uint8Array(t.altcursorcol).buffer).getUint32(0),o.setUint32(16,i),o.setUint32(48,r),t.altuseroption=null,t.altcursorrow=null,t.altcursorcol=null}for(var a=[],l=0;l<new Uint8Array(o.buffer).length;l++)a[l]=o.getUint8(l)}var c={cmd:"appxmessage",args:[0,0,0,2,12,0,0,0],handler:"appxshowhandler",data:null}
if(appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:[0,54,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,255,0,209,0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:a,handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),0!=Math.abs(n&M_COMPARE)&&appx_session.dirtySinceSave?(c={cmd:"appxmessage",args:[1],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))):(c={cmd:"appxmessage",args:[0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))),appx_session.override)c={cmd:"appxmessage",args:[0,0,0,2,86,0,0,0,0,0,0,1,11,27,0,3,84,82,75],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
else if(s.length>0){c={cmd:"appxmessage",args:[0,0,0,2,86,0,0,0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
for(var d=[],x=0;x<s.length;x++){var u=""
if($(s[x]).find(".appxdatevalue").val())u=$(s[x]).find(".appxdatevalue").val()
else if($(s[x]).closest(".appxitem").find("input").val())u=$(s[x]).closest(".appxitem").find("input").val()
else if($(s[x]).hasClass("masked")&&""===$(s[x]).val())u=$(s[x]).data()._inputmask_opts.alias.replace(/\*/g," ")
else if($(s[x]).val())if($(s[x]).hasClass("appxfilewrapper")&&$(s[x]).hasClass("DULC")||$(s[x]).hasClass("DnD")){var g,o=$(s[x]).val()
if(g=appx_session.filesUploadArray.length,g>1||$(s[x]).hasClass("DnD")){var _=u="$(sendFile)\\c:\\directory\\",h="folder"
$(s[x]).hasClass("DnD")&&1==g&&(h="file",_=u="$(sendFile)\\")
for(var l=0;l<g;l++){var f=appx_session.filesUploadArray[l].name.replace(/ /g,"_"),w="$(sendFile)\\[["+l+"]]"+f
1==g&&(w="$(sendFile)\\"+f)
var b,m
b=$(s[x]).data("row"),m=$(s[x]).data("col"),appx_session.dndData.push({row:b,col:m,parentType:$(s[x]).data("parent_type"),path:_+f,name:w,ext:f.substring(f.lastIndexOf(".")+1).toLowerCase(),mtype:h,size:appx_session.filesUploadArray[l].size.toString(),props:[]})}}else u=o.indexOf("\\")>-1||o.indexOf("/")>-1?o.indexOf("\\")>-1?"$(sendFile)"+o.substring(o.lastIndexOf("\\")):"$(sendFile)"+o.substring(o.lastIndexOf("/")):"$(sendFile)\\"+o}else u=$(s[x]).val()
else $(s[x]).closest(".appxitem").val()?u=$(s[x]).closest(".appxitem").val():$(s[x]).find(".appx-data").html()?u=$(s[x]).find(".appx-data").html():$(s[x]).hasClass("togglebutton")&&(u=$(s[x]).hasClass("down")?"Y":"N")
"uppercase"==$(s[x]).css("text-transform")&&(u=u.toUpperCase()),u=u.replace("‘","'"),u=u.replace("’","'"),u=u.replace("“",'"'),u=u.replace("”",'"')
var v=$(s[x]).closest(".appxitem").attr("id")
if(""!=v&&v||(v=$(s[x]).closest(".appxitem").closest("div").attr("id")),void 0!==v){var y=parseInt($("#"+v).data("row"))
d.push(y)
var S=parseInt($("#"+v).data("col"))
d.push(S)}else{var y=parseInt($(s[x]).closest(".appxwidget").closest("div").data("row"))
d.push(y)
var S=parseInt($(s[x]).closest(".appxwidget").closest("div").data("col"))
d.push(S)}var k=toUTF8Array(u),T=k.length%256,C=(k.length-T)/256
d.push(C),d.push(T),Array.prototype.push.apply(d,k)}clearClientIds(),$(s[0]).hasClass("DnD")?(c={cmd:"appxmessage",args:[0,0,0,0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))):(c={cmd:"appxmessage",args:hton32(s.length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:d,handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)))}else c={cmd:"appxmessage",args:[0,0,0,2,86,0,0,0,0,0,0,0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
c={cmd:"appxmessage",args:[0,0,0,4,90,0,0,0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
var I=0
s=$(".appxtablewidget")
for(var d=[],x=0;x<s.length;x++){var P=$(s[x]).data()
if(P.selkeys)for(var O=0;O<P.selkeys.length;O++){var u=""
u=P.selkeys[O]
var y=[0,0,0,parseInt(P.row)]
Array.prototype.push.apply(d,y)
var S=[0,0,0,parseInt(P.col)]
Array.prototype.push.apply(d,S)
var A=[0,0,0,I+1]
Array.prototype.push.apply(d,A),d.push(6),d.push(u.length/2)
for(var E=0;E<u.length;E+=2)d.push(parseInt(u.substring(E,E+2),16))
I++}}var R=[0,0,0]
R.push(I),c={cmd:"appxmessage",args:R,handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),s.length>0&&(c={cmd:"appxmessage",args:d,handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))),c={cmd:"appxmessage",args:[0,0,0,4,92,0,0,0],handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
var B=appx_session.dndData.length
c={cmd:"appxmessage",args:hton32(B),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
for(var M=($("meta[name=appx-character-encoding]").attr("content"),0);M<B;M++){var D=appx_session.dndData[M]
c={cmd:"appxmessage",args:hton32(D.row),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton32(D.col),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton32(D.parentType),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton16(toUTF8Array(D.path).length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:toUTF8Array(D.path),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton16(toUTF8Array(D.name).length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:toUTF8Array(D.name),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton16(toUTF8Array(D.ext).length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:toUTF8Array(D.ext),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton16(toUTF8Array(D.mtype).length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:toUTF8Array(D.mtype),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton32(D.size),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
var U=D.props.length
c={cmd:"appxmessage",args:hton16(U),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))
for(var N=0;N<U;N++){var L=D.props[N]
c={cmd:"appxmessage",args:hton16(toUTF8Array(L.name).length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:toUTF8Array(L.name),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:hton16(toUTF8Array(L.value).length),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c)),c={cmd:"appxmessage",args:toUTF8Array(L.value),handler:"appxshowhandler",data:null},appx_session.ws.send(JSON.stringify(c))}}appx_session.dndData=[]}catch(z){console.log("sendappxshow: "+z),console.log(z.stack)}}function appxIsLocked(){return appx_session.locked}function appxSetLocked(e){if(appx_session.locked=e,!e)for(;appx_session.runOnUnlock.length;)appx_session.runOnUnlock.shift().call()}function appxGetCellSize(){return{w:appx_session.colWidthPx,h:appx_session.rowHeightPx}}function appxFixCursorCol(e){return e<1&&(e=1),e>appx_session.screencols&&(e=appx_session.screencols),e>255&&(e=255),e}function appxFixCursorRow(e){return e<1&&(e=1),e>appx_session.screenrows-3&&(e=appx_session.screenrows-3),e>255&&(e=255),e}function appxGetCursorPos(){var e=appxFixCursorCol(ab2int32(appx_session.current_show.cursorcol)),s=appxFixCursorRow(ab2int32(appx_session.current_show.cursorrow))
return{col:e,row:s}}function appxIsInProgress(e){return 0!=Math.abs(e.bit_mask&IN_PROGRESS)&&(null==e.widget||203!=e.widget.wWidgetType)}function appxIsEmBuild(e){return 0!=Math.abs(e.bit_mask&IN_PROGRESS)&&null!=e.widget&&203==e.widget.wWidgetType}function appxIsFullscreen(e){try{return e.end_column-e.begin_column+1>=appx_session.screencols&&e.end_row-e.begin_row+1>=appx_session.screenrows-3}catch(s){console.log("screen.appxIsFullscreen: "+s),console.log(s.stack)}}function appxIsScroll(e){return 0!=Math.abs(e.bit_mask&SCROLL)}function appxIsScrollAct(e){return 0!=Math.abs(e.bit_mask&SCROLL_ACT)}function appxIsScrollReg(e){return 0!=Math.abs(e.bit_mask&SCROLL_REG)}function appxSnapshotScanCursor(){appx_session.scan_cursorrow=appx_session.current_show.cursorrow,appx_session.scan_cursorcol=appx_session.current_show.cursorcol}function appxGetScanCursorPos(){var e=appxFixCursorCol(ab2int32(appx_session.scan_cursorcol)),s=appxFixCursorRow(ab2int32(appx_session.scan_cursorrow))
return{col:e,row:s}}function appxClearScanCursor(){appx_session.scan_cursorrow=-1,appx_session.scan_cursorcol=-1}function appxPutCursor(e,s){try{var a=!1
if(!appxIsLocked()){var t=appxGetCursorPos()
t.col==e&&t.row==s||(appx_session.current_show.cursorcol=[0,0,0,appxFixCursorCol(e)],appx_session.current_show.cursorrow=[0,0,0,appxFixCursorRow(s)],a=appxshowcursor(!1))}return a}catch(n){console.log("appxPutCursor: "+n),console.log(n.stack)}}function appxPutTabOut(){try{if(!appxIsLocked()){var e=appxGetCursorPos()
appx_session.current_show.altcursorcol=[0,0,0,appxFixCursorCol(e.col)],appx_session.current_show.altcursorrow=[0,0,0,appxFixCursorRow(e.row)],appx_session.current_show.altuseroption=[0,0,1,76]}}catch(s){console.log("appxPutTabOut: "+s),console.log(s.stack)}}function appxScrollClick(e){var s=e.data("col"),a=e.data("row")
s&&a&&(appxPutCursor(s,a),appxwidgetcallback(OPT_ENTER))}function appxSetStatusPIDText(e){$("#appx_status_pid").html(e)}function appxSetStatusDbText(e){$("#appx_status_db").html(e)}function appxSetStatusApText(e){$("#appx_status_ap").html(e)}function appxSetStatusVerText(e){$("#appx_status_ver").html(e)}function appxSetStatusUserText(e){$("#appx_status_user").html(e)}function appxSetStatusKeymapText(e){$("#appx_status_keymap").html(e)}function appxSetStatusMsgText(e){appxSetStatusText(e)}function appxSetStatusModeText(e){$("#appx_status_mode").html(e)}function appxSetStatusStateText(e){if(e!=appx_state_last){appx_state_last=e
var s=$("<span>")
switch(e){case APPX_STATE_BUSY:$("*").addClass("wait"),s.html("busy").addClass("appx-state-busy")
break
case APPX_STATE_READY:$("*").removeClass("wait"),s.html("ready").addClass("appx-state-ready")
break
case APPX_STATE_DIRTY:s.html("ready+").addClass("appx-state-dirty"),appx_session.dirtySinceSave=!0
break
case APPX_STATE_IMAGES:s.html("images").addClass("appx-state-images")
break
case APPX_STATE_EMS:s.html("compile").addClass("appx-state-ems")}$("#appx_status_stat").html(s)}}function appxSetStatusEmbldText(e){$("#appx_status_embld").html(e)}function appxSetStatusProgressText(e){$("#appx_status_progress").html(e)}function appxClearStatusMsgText(){$("#appx-status-msg").html(""),$("#appx-status-msg").css("background-color","white")}function appxSetStatusText(e){e=e.trim()
var s=$("#appx-status-msg")
if(s.length>0){var a=""==e?"white":"lime"
""!=e&&(e.indexOf("Error - ")!=-1?a="red":e.indexOf("Warning - ")!=-1&&(a="yellow")),""!=e&&s.prepend(e+"\n\n")}}function appxstarttimeout(){appxstoptimeout()
var e=appx_session.current_show
!e||null==e.timeout||e.timeout<=0||e.timeout>6e4||(appx_session.interactT=setTimeout(function(){appxwidgetcallback(e.useroption?ab2int32(e.useroption):OPT_DIR_PROC_1)},1e3*e.timeout))}function appxstoptimeout(){appx_session.interactT&&clearTimeout(appx_session.interactT),appx_session.interactT=null}function appxstartblurtimeout(){appxstopblurtimeout(),appx_session.interactTblur=setTimeout(function(){appxwidgetcallback(OPT_TAB_OUT)},1e3)}function appxstopblurtimeout(){appx_session.interactTblur&&clearTimeout(appx_session.interactTblur),appx_session.interactTblur=null}function RowTextStruct(){this.type=ROWTEXT_TYPE_NONE,this.boxid=0,this.pos_row=0,this.pos_col=0,this.size_rows=0,this.size_cols=0,this.string=null,this.uline=!1}function showPopup(e){if(e)var s="<h1>About APPX</h1>Server Connector Version: "+appx_session.getProp("serverConnectorVersionStr")+"</br>Local Connector Version: "+appx_session.getProp("localConnectorVersionStr")+"</br>Browser Client APPX Directory Version: "+appx_session.getProp("clientServerVersionStr")+"</br>Browser Client Web Directory Version: "+appx_session.getProp("clientPublicVersionStr")
else var s="<h1>Functionality Not Currently Enabled</h1><p>Functionality for this option has not been enabled in this release of APPX.</p>"
var a=($("<div id='appx_popup'>").css({background:"rgba(50, 50, 50, 0.7)",width:"100%",height:"100%","min-height":"220px","z-index":"10000000",display:"none",position:"absolute",top:"0px",left:"0px","font-family":"verdana","font-size":"11px"}).appendTo("body"),$("<div style='border: 10px solid #333;'>").css({width:"550px",height:"220px",background:"#fff"}).appendTo("#appx_popup").position({my:"center",at:"center",of:window}).draggable()),t=$("<div>").css({margin:"0px 10px",width:"550px",height:"220px"}),n=$("<div>").css({background:"#333","text-align":"right",padding:"5px",color:"#F5F539","font-weight":"bold","padding-bottom":"10px"}).append($("<span>close(X)</span>").click(function(){$("#appx_popup").hide(),$("#appx_popup").remove(),"true"===appxLocalRequired&&(localos_session=new LOCALOS)}))
$(a).prepend($("<div>").append(n)),$(t).append($("<div>").append(s)),$(t).appendTo(a),$("#appx_popup").show()}var screenflipped=!1,blocked=!1,inProgressBox=null,_boxcur=null,$_screenBuf=null,M_SHOW=2,M_WAIT=8,M_COMPARE=32,M_SAVE=64,SCROLL=65536,SCROLL_REG=131072,SCROLL_ACT=262144,IN_PROGRESS=524288,BORD_AROUND=2147483648,APPX_STATE_BUSY=0,APPX_STATE_READY=1,APPX_STATE_DIRTY=2,APPX_STATE_IMAGES=3,APPX_STATE_EMS=4,appx_state_last=-1,ROWTEXT_TYPE_NONE=0,ROWTEXT_TYPE_ITEM=1,ROWTEXT_TYPE_WIDGET=2
